# shell脚本基础应用

## 一、脚本执行

- 编写一个最简单的脚本并保存在/opt/learn/helloworld.sh下

  ```shell
  #!/usr/bin/bash
  #这是一个最简单的shell脚本（注释）
  echo "Hello"
  ```

- 使用如下命令运行helloworld.sh

  ```shell
  . helloworld.sh
  sh helloworld.sh
  bash helloeorld.sh
  source helloworld.sh
  chmod u+x helloworld.sh
  ./helloworld.sh
  ```

## 二、传递参数给shell脚本

| 命令                        | 作用                              |
| --------------------------- | --------------------------------- |
| echo "Hello,$1 $2 $3"       | 程序体输出Hello后面带三个参数的值 |
| sh hello.sh Denny Bill Mary | 运行时会输出Hello,Denny,Dill,Mary |
| $1                          | 代表第一个参数                    |
| $2                          | 代表第二个参数                    |
| ……                          | 以此类推，但不能超过9个参数       |
| $0                          | 特殊的，$0表示该shell脚本的名称   |

## 三、引号的用法

| 命令                             | 作用                                                  |
| -------------------------------- | ----------------------------------------------------- |
| echo "$1"                        | 输出第一个参数的值                                    |
| echo '$1'                        | 输出$1                                                |
| echo 'date'                      | 输出date                                              |
| echo \`date`                     | 输出当前时间（这里使用的是~下面的反引号而不是单引号） |
| now=\`date "+%Y-%m-$d %H:%M:%S"` | 格式化输出时间，同时赋值                              |

### 1.单引号

- 单引号引用内容所见即所得

- 单引号是全引用，被单引号括起的内容不管是常量还是变量都不会发生替换

  ```shell
  var=1
  echo '$var'
  # 输出为 $var
  ```

### 2.双引号

- 双引号引用的内容，所见非所得。

- 如果引号内容中有命令、变量等，会先把变量、命令解析出结果，然后在输出最终内容。

- 双引号是部分引用，被双引号括起的内容常量还是常量，变量则会发生替换，替换成变量内容。

  ```shell
  var=1
  echo "$var"
  # 输出为 1
  ```

### 3.反引号

- 用反引号，将shell命令引起来，可以将命令的输出值赋给变量

- $() 与 反引号 `` 其实效果是一样

  ```shell
  echo `date`
  # Mon Jan 1 00:00:00 CST 2077
  echo $(date)
  # Mon Jan 1 00:00:00 CST 2077
  
  now= `date "+%Y-%m-$d %H:%M:%S"`
  echo $now
  # 2077-1-1 00:00:00
  ```

### 4.无引号

- 不使用引号定义字符串时，字符串不能包含空白字符（如 Space 或 Tab），需要加引号。

- 一般连续的字符串、数字、路径等可以不加引号。

- 如果内容有命令、变量等，会先把变量、命令解析出结果，然后再输出最终内容。

- 字符串含有空格时不使用引号括起来，将无法正常输出。

  ```shell
  var=tset string
  echo $var
  # 输出为空
  ```

## 四、括号的用法

- 圆括号：括号一般在命令替换时与美元符号$配合使用，用于获取括号内命令的输出

- 方括号：Shell中的方括号一般有两种使用场景

  - 一种是和美元符号$搭配用于Shell中整型数据运算

    ```shell
    # 用于整型数据计算
    var1=100
    var2=200
    # 可以使用 $+方括号来代替test命令整型运算
    var3=$[ $var1+$var2+1 ]
    # 第一个方括号后面和第二个方括号后面要加空格，否则会报错
    
    # 也可以使用 $+双括号来表示整型运算
    var4=$(($var1 + $var2 + 1))
    echo $var3
    echo $var4
    ```

  - 另一种是单独使用，作为test命令的简写形式

    ```shell
    # 数值比较
    n1=20
    n2=10
    if [ $n1 -ge $n2 ]; then
        echo "n1 is greater than or euqal to n2"
    else
        echo "n1 is less than n2"
    fi
    # Bash Shell只能直接处理整数，浮点数比较会报错
    ```

- 花括号：一般用于需要变量和字符串组合输出时，若想要实现变量后拼接字符串就需要使用花括号

  ```shell
  var=50
  var1=100
  var2=200
  # 若想要实现var变量后拼接字符串就需要使用花括号
  echo $var1 ${var}1
  echo $var2 ${var}2
  ```

- 双方括号：双方括号提供了针对字符串比较的高级特性，能够使用数学符号比较字符串，并实现了模式匹配

  ```shell
  fileName=test5
  if [[ $fileName==test* ]]; then
      echo "This is a test file!"
      if [[ $fileName==test5 ]]; then
          echo "This file is test5!"
      fi
  fi
  ```

## 五、特殊用法

### 1. 特殊变量

| 命令   | 作用                                                         |
| ------ | ------------------------------------------------------------ |
| **$#** | **传递到脚本的参数个数**                                     |
| $0     | 脚本的名称                                                   |
| $*     | 以一个单字符串的形式显示所有向脚本传递的参数，与位置变量不同，此项参数可以超过9个 |
| $$     | 脚本运行的当前进程ID号                                       |
| $!     | 后台运行的最后一个进程的进程ID号                             |
| $@     | 与$*相同，但是使用时加引号，并在引号中返回每个参数           |
| **$?** | **显示最后命令的退出状态，0表示正确，其他任何值表示错误 特别的：在脚本中可自定义0~255的退出状态码** |
| $_     | 代表上一个命令的最后一个参数，如果上一个命令是echo,则这个参数就是echo显示的内容 |

- 理解*与@的区别

  ```shell
  function testargs
  {
  	echo "There is $# args"
  	echo $10
  }
  testargs "$*"
  testargs "$@"
  # $*的结果是所有参数构成一个字符串:"11 22 33 44"
  # $@的结果是每一个参数单独加上引号："11" "22" "33" "44"
  ```

### 2. expr表达式

| 命令                 | 作用                                                         |
| -------------------- | ------------------------------------------------------------ |
| expr 10 + 10         | expr是一个手工计算器，此处会输出20（注意空格）               |
| expr 10+10           | 此处会输出10+10                                              |
| expr 10.1 + 1        | expr不能处理小数                                             |
| expr "hello"="hello" | 成功返回1，失败返回0                                         |
| 练习：               | 使用echo命令输出一句话：300/5\*6=360,其中360由运算得到：echo "300/5\*6=\`expr 300 \/ 5 \* 6`"       （要加转义符） |

## 六、test命令

### 1. test文件

| 命令                | 作用                                                  |
| ------------------- | ----------------------------------------------------- |
| test -e /etc/passwd | 测试文件/etc/passwd是否存在，存在则$?返回0，否则返回1 |
| [ -e /etcc/passwd ] | 与test -e /etc/passwd作用一样，注意空格               |
| -d file             | 如果文件为一个目录，则为真                            |
| -e file             | 如果文件存在，则为真                                  |
| -f file             | 如果文件为一个普通文件，则为真                        |
| -r file             | 如果文件可读则为真                                    |
| -w file             | 如果文件可写，则为真                                  |
| -x file             | 如果文件可执行，则为真                                |
| -s file             | 如果文件长度不为0，则为真                             |
| -L file             | 如果文件为符号文件，则为真                            |

### 2. 逻辑处理

| 命令                              | 作用                                           |
| --------------------------------- | ---------------------------------------------- |
| -e /etc/passwd -a -r /etc/passwd  | 逻辑与，操作符两边均为真，结果为真，否则为假   |
| -e /etcc/passwd -o -r /etc/passwd | 逻辑或，操作符两边一边为真，结果为真，否则为假 |
| !  -e /etc/passwd                 | 逻辑否，条件为假，结果为真                     |

### 3. test字符串

| 命令             | 作用             |
| ---------------- | ---------------- |
| $USER = "root"   | 字符串比较       |
| "$USER" = "root" | 建议使用此种方式 |
| =                | 等于             |
| !=               | 不等于           |
| -z               | 为空字符串       |
| -n               | 非空字符串       |

### 4. test数值

| 命令             | 作用                     |
| ---------------- | ------------------------ |
| [ $$ -eq 18646 ] | 对数值的测试             |
| -eq              | 数值相等                 |
| -ne              | 数值不等                 |
| -le              | 第一个数小于等于第二个数 |
| -ge              | 大于等于                 |
| -gt              | 大于                     |
| -lt              | 小于                     |

