# 以太网与以太网交换机

## 一、数据链路层功能

- 数据链路层所传输的是数据帧，所封装的的是MAC头部（主要有源MAC地址，目的MAC地址）、差错检验
- 建立逻辑链接，进行物理地址寻址，差错校验
- 数据链路的建立、维护和拆除
- 封装成帧、透明传输、差错检验，在数据链路层也可以做流量控制（一般情况下不在数据链路层做）

---

## 二、以太网

　### 1. 基本概念

- 回顾以太网标准（802局域网标准）

- 以太网==局域网

- 交换机主要讲的以太网交换机（局域网的交换机）

- 早期的网络是共享式网络，目前使用的是交换式网络

  交换式网络：以太网交换机、以太网MAC地址

### 2. 以太网的MAC

- 用来标识一个以太网的某个单独的设备或一组设备		**IP地址的概念：用于表示==网络==中的某一台主机**

  - 两个设备想在以太网中通讯，那就必须额要MAC地址进行交互

  - 两个设备要在网络中通信，就必须配置相应的IP地址

- MAC地址有48位二进制组成，通常表示为12位的16进制

  ```
  80-30-49-AD-48-C3
  10000000-00110000-01001001-10101101-01001000-11000011
  ```

- 一个MAC地址的表示方式：前24位表示了厂商的编码，后24位是序列号。从而就可以实现全球唯一。

- 单独设备：当第8位为0表示单独设备，单播地址

- 一组设备：当第8位为1表示一组设备，组播地址

  ```
  01-00-5e-00-00-fc
  00000001-00000000
  ```

- 所有设备：FF-FF-FF-FF-FF-FF，一个权威1的MAC地址，广播地址

- 00-00-00-00-00-00：默认填充地址，不知道对方的MAC地址时，会自动填充一个目的MAC地址

### 3. 以太网的帧

- Ethernet Ⅱ
- IEEE802.3帧
- ![img](..\..\picture\b77edc18058b4af3b4da21c589d9c7a0.png)
- Type和Length：都是用于去标识上层数据的类型
  - 上层是网络层
  - 由于在网络层有不同协议：IP（0800）  ARP（0806）  ICMP  IGMP
  - 把ICMP协议称为网络层上层协议（3.5层协议）

---

## 三、以太网交换机

### 1. 交换机工作原理

- 早期以太网是共享式以太网，是由集线器（HUB工作在物理层）相连

  - 一个冲突域的网络

- 现在采用交换式网络（以太网交换机）

  - 广播：一种信息的传播方式，一对多的方式

  - 交换机工作在数据链路层

  - MAC表中维护的是发送方的MAC地址和接口的对应关系

  - 当交换机收到发来的数据帧后查看帧头部，首先查看源MAC地址有没有记录在自己的MAC表中，如果没有，那么记录：主机A－－接口１，继续查看目的MAC地址，如果没有，就直接从除接收接口外的所有链接的接口转发（这种方式称为广播），主机B和主机C都收到，主机C丢弃，主机B回应，发现目标的MAC对应在１号口上，直接（单播（一对一）转发）

    ![image-20220602234151300](..\..\picture\1ef7c993e5584e1f96b8d5a8e7f23efb.png)

  - 首先学习源MAC地址，接着广播数据帧，接收方单播回应，其他主机丢弃，下次转发直接单播方式转发数据

### 2. 工作模式

- 单工：数据包只能单向传输
- 半双工：数据可以双向传输，但不能同时进行
- 全双工：数据可以双向且可以同时进行

## 四、交换机基本配置

### 1. 目标

- 掌握思科设备的命令行基础
- 会对交换机进行基本配置
- 会通过telnet和ssh对交换机进行远程管理

### 2. 思科设备命令行基础

- 要想进入设备的命令行界面

  设备支持命令行

  - 查看设备上的接口，console

  需要有console线

  需要超级终端软件连接

  - putt
  - secret CRT
  - Xshell

- 命令行基础

  思科设备上的命令行模式

  - 用户模式：查看统计信息（一般情况下很少），用">"表示

    ```shell
    enable	#用户模式切换到特权模式
    en		#命令可以简写
    ```

    

  - 特权模式：查看并修改设备的配置（一般都是查看居多），用"#"表示

    ```shell
    configure terminal	#特权模式切换到全局模式
    conf t		#命令可以简写
    ```

    

  - 全局模式：针对设备的整体配置参数，用"(config)#"表示

    ```shell
    interface fasteternet0/1	#全局模式切换到接口模式
    in f0/1		#命令可以简写,f0/1为某一个接口
    ```

    

  - 接口模式：针对设备的接口修改配置参数，用"(config-if)#"表示

  - 进入对应模式，只能一级一级进入

  - 返回对应模式，一级一级返回使用"exit"，如果想要快速返回到特权模式，使用"end"

  - 当命令输错后进入

    ```shell
    Switch>dfds
    Translating "dfds"...domain serner (255.255.255.255)
    #快速重置按 ctrl+shift+6
    #永久不进行域名解析
    Switch(config)#mo ip domain-lookup		#注意模式
    ```

### 3. 常见配置

- 给交换机配置一个主机名

  ```shell
  Swiltch>en
  Switch#conf t
  Switch(config)#hostname SW1
  SW1(cinfig)#
  ```

- 交换机里面维护了一张MAC表，如何查看

  ```
  SW1#show mac-address-table
  ```

- 交换机的双工模式

  ![image-20220603100114720](..\..\picture\0ca6ca3e80104dc9acabddd2016d6161.png)

- 交换机的接口速率

  ![image-20220603100214933](..\..\picture\a39c37ea5a5840a2a8af2bd8d635492f.png)

- 配置console口密码

  ![image-20220603100251584](..\..\picture\55e963ed61254aa3869db0dc7a451ea5.png)

## 五、通过远程管理方式连接交换机（telnet	ssh）

### 1. telnet和ssh

- telnet是应用层协议 基于传输层TCP，默认端口：23	采用明文密码方式，不安全，一般用于内网管理
- ssh是应用层协议 基于传输层TCP，默认端口：22    采用的是密文密码方式，相对来说比较安全，经常用于跨越互联网管理，也常用于远程管理Linux操作系统

### 2. 思路

- telnet

  - 既然是通过网络方式进行管理设备，设备就必须配置IP地址，由于交换机上的接口都是交换接口，是不允许配置IP地址，直接为交换机虚接口配置IP地址，默认情况下交换机的默认虚接口就是Vlan1接口

    <img src="https://s2.loli.net/2022/07/22/EqvrWk2NXajHBRP.png" alt="image-20220603102416058" style="zoom:200%;" />

  - 配置设备连接终端并直接设置密码，应用

    ![image-20220603104541375](..\..\picture\07977872ce54486eb05642bdd5a35759.png)

  - 创建连接用户名密码，配置设备的连接终端并应用

    ![image-20220603104605355](..\..\picture\69e417ffc0ed4ff4b2f4c41736d8cab6.png)

- ssh

  ![image](..\..\picture\kriZdq3SnAYmNfT.png)

### 3. 设置特权模式密码

- 当同时设置了明文密码和密文密码，密文密码生效

  ![image-20220603103936424](..\..\picture\04d802d19f3249009496d60383653075.png)



