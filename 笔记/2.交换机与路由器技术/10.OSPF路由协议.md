# OSPF动态路由协议

## 一、基本概念

- OSPF是开放式最短路径优先路由协议，是一个内部网关路由协议（在同一个自治系统内进行决策路由
- 链路状态路由协议：在单一区域内的路由器发送链路状态信息，网络收敛后形成网络拓扑
- 工作过程
  - 相邻的路由器建立**邻接关系**
  - 根据链路状态信息，形成**链路状态数据库**
  - 根据OSPF自己的算法，进行**最短路径树**的计算
  - 最终形成**路由表**

## 二、OSPF区域

### 1. 划分区域

- 为了适应大型网络
- 每个OSPF的路由器只维护自己所在区域的链路状态信息
- 每个区域都有一个区域ID
  - 区域ID可以表示成一个十进制
  - 也可以表示成一个IP地址
- 骨干区域
  - 主要负责区域之间的路由信息传播
  - 区域ID：0或0.0.0.0
- 非骨干区域
  - 普通区域
- 默认情况下，所有非骨干区域都和骨干区域直连

### 2. 单区域内容

- 在同一个区域中通过选举DR和BDR来节省网络中的流量
  - 区域中其他路由器只会和DR、BDR建立邻接关系
- DR和BDR的选举
  - 通过route ID进行选举，route ID 最大的路由器作为DR，第二大的作为BDR
  - route ID
    - 首先选取路由器loopback*（路由器上的虚拟接口，该接口可以收发路由协议报文，也可以配置IP）*上数值最高的地址
    - loopback上没有配置地址，选取物理接口上最大的IP地址
    - 也可以直接使用route-id直接指定

### 3. OSPF的度量值

- cost值（代价）
  - 基于链路带宽决定
    - 100Mbps--1
    - 10Mbps --10

### 4. 邻接关系建立

- 以什么方式发送数据报文
  - 以组播方式发送
    - 224.0.0.5--代表所有OSPF路由器
    - 224.0.0.6--代表DR 、BDR
- 报文类型
  - hello报文：用于发现和维持邻居关系，用于选举DR和BDR
  - 数据库描述包（DBD）：向邻居发送自己的链路状态描述信息用来同步链路状态数据库
  - 链路状态请求包（LSR）
  - 链路状态更新包（LSU）
  - 链路状态确认包（LSAck）

### 5. OSPF和RIP对比

- RIP：RIP1和RIP2
  - RIP1，不支持可变长子网掩码，使用广播更新
  - RIP2，使用组播更新
  - 条数限制是15跳
  - 不能划分区域，网络收敛慢
- OSPF
  - 使用组播更新
  - 网络收敛快，通过区域划分
  - 支持可变长子网掩码，主要体现在宣告时携带子网掩码

## 三、OSPF单区域配置

```
router ospf 10
#10代表ospf进程
```

```
network 192.168.10.0 0.0.0.255 area 0
192.168.10.0 --宣告的网段
0.0.0.255 --子网掩码的反码
area 0 --表示宣告的区域
```

```
show ip ospf --查看ospf配置信息
show ip ospf neighbir --查看邻接
```

## 四、OSPF多区域

### 1. 目的

- 实现大型网络环境
- 划分区域后，实现单区域网络收敛

### 2. 好处

- 改善网络，更具有拓展性
- 快速网络收敛
- 减少了路由表，也减少了LSU的流量

### 3. OSPF的通信流量

- 在区域内（域内通信流量）
  - DR和BDR
  - 内部路由器
- 不同区域之间（域内通信量）
  - ABR（区域边界路由器）
- 与其他自治系统之间（外部通信量）
  - ASBR（自治系统边界路由器）

### 4. 区域

- 骨干区域
  - area 0
- 非骨干区域
  - 标准区域
  - 末梢区域
  - 完全末梢
  - 非纯末梢

### 5. 链路状态通告（LSA）

- 6种链路状态通告
  - 类型1：路由器LSA，由区域内的路由器发出（内部路由器）
  - 类型2：网络LSA，由区域内的DR发出
  - 类型3：网络汇总LSA，由ABR发出
  - 类型4：ASBR汇总LSA，由ABR发出
  - 类型５：AS外部LSA，由ASBR发出
  - 类型7：非纯末梢区域的外部LSA

### 6. 末梢区域

- 定义

  - 只有一个默认路由作为其区域的出口

  - 区域不能作为虚链路的穿越区域

  - 末梢区域里面没有自治系统边界路由器ASBR

  - 不是骨干区域

- 特征

  - 末梢区域没有LSA类型4、5、7
  - 完全末梢区域除了一条默认路由外的LSA3通告，没有LSA3、4、5、7
  - 减少区域内的链路状态通告